'use strict';

var scrypt = require('@noble/hashes/scrypt');
var rand = require('../rand.js');

const defaultScryptParams = {
    // N is the N parameter of Scrypt encryption algorithm, using 256MB
    // memory and taking approximately 1s CPU time on a modern processor.
    N: 1 << 18,
    // P is the P parameter of Scrypt encryption algorithm, using 256MB
    // memory and taking approximately 1s CPU time on a modern processor.
    p: 1,
    r: 8,
    keyLen: 32,
};
function deriveSecretFromScrypt(passphrase = '', params = defaultScryptParams, salt = rand.secureRandom(32)) {
    const secret = scrypt.scrypt(new Uint8Array(Buffer.from(passphrase, 'ascii')), salt, {
        N: params.N,
        r: params.r,
        p: params.p,
        dkLen: params.keyLen,
    });
    return {
        params,
        secret,
        salt,
    };
}

exports.defaultScryptParams = defaultScryptParams;
exports.deriveSecretFromScrypt = deriveSecretFromScrypt;
