'use strict';

var addressFormattingRule = require('./addressFormattingRule.js');
var formatMailLike = require('./formatMailLike.js');
var nameServiceAddress = require('./nameServiceAddress.js');

function formatAddress(address, format) {
    if (nameServiceAddress.isNameServiceAddress(address))
        return formatNameServiceAddress(address, format);
    throw new Error(`unknown format of the provided address [${JSON.stringify(address)}]`);
}
function formatNameServiceAddress(address, format) {
    switch (format) {
        case 'mail':
            return formatMailLike.formatMailLike(address.username, address.domain);
        case 'human-friendly':
            for (const formatter of addressFormattingRule.humanNameServiceFormatters) {
                const formatted = formatter(address);
                if (formatted)
                    return formatted;
            }
            throw new Error(`failed to format address [${JSON.stringify(address)}]`);
    }
}

exports.formatAddress = formatAddress;
