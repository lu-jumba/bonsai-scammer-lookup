'use strict';

var headers = require('./headers.js');
var serialization = require('../serialization/serialization.js');
var encrypt = require('../serialization/encrypt.js');
var chunk = require('../serialization/chunk.js');

async function serializeAndEncryptPayload(payload, payloadRootEncryptionKey) {
    const headers$1 = headers.SerializableTransportPayloadHeaders.FromEncryptedPayloadHeaders(payload.Headers).ToBuffer();
    return serialization.serialize(await encrypt.encryptPayload(headers$1, payload.Content, payloadRootEncryptionKey, chunk.CHUNK_LENGTH_1MB));
}

exports.serializeAndEncryptPayload = serializeAndEncryptPayload;
