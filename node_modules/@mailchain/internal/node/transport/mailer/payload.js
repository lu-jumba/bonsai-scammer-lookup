'use strict';

var crypto = require('@mailchain/crypto');
var encoding = require('@mailchain/encoding');
var content = require('./content.js');

async function createMailerPayload(mailerMessagingKey, contentPayload) {
    const contentBuffer = Buffer.from(content.createContentBuffer(contentPayload));
    return {
        Headers: {
            Origin: mailerMessagingKey.publicKey,
            ContentSignature: await mailerMessagingKey.sign(contentBuffer),
            Created: new Date(),
            ContentLength: contentBuffer.length,
            ContentType: 'message/x.mailchain-mailer',
            ContentEncoding: encoding.EncodingTypes.Base64,
            ContentEncryption: crypto.KindNaClSecretKey,
        },
        Content: contentBuffer,
    };
}

exports.createMailerPayload = createMailerPayload;
