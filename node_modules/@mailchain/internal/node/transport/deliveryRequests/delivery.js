'use strict';

var crypto = require('@mailchain/crypto');
var protocol = require('../../protobuf/protocol/protocol.js');
var envelope = require('./envelope.js');

/* eslint-disable @typescript-eslint/naming-convention */
async function createDelivery(recipientMessagingKey, messageRootEncryptionKey, messageURI, rand = crypto.secureRandom) {
    const payload = {
        envelope: await envelope.createEnvelope(recipientMessagingKey, messageRootEncryptionKey, messageURI, rand),
    };
    const errMsg = protocol.protocol.Delivery.verify(payload);
    if (errMsg)
        throw Error(errMsg);
    return protocol.protocol.Delivery.create(payload);
}

exports.createDelivery = createDelivery;
