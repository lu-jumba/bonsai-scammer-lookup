import { isSameAddress } from '@mailchain/addressing';
import uniqWith from 'lodash/unionWith';

function consolidateMailbox(mailbox) {
    const consolidators = [consolidateMailboxLabel, consolidateMailboxAliases];
    return consolidators.reduce((prev, consolidator) => consolidator(prev), mailbox);
}
function consolidateMailboxLabel(mailbox) {
    return { ...mailbox, label: mailbox.label?.trim() || null };
}
/**
 * Consolidate the provided mailbox aliases with the following rules:
 * - There can be only single alias per `address`. If there are duplicates, only the first one in the entries is kept, the others are ignored.
 */
function consolidateMailboxAliases(mailbox) {
    return {
        ...mailbox,
        aliases: uniqWith(mailbox.aliases, (a, b) => isSameAddress(a.address, b.address)),
    };
}

export { consolidateMailbox, consolidateMailboxAliases, consolidateMailboxLabel };
