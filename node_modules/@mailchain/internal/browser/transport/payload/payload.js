import { SerializableTransportPayloadHeaders } from './headers.js';
import { serialize } from '../serialization/serialization.js';
import { encryptPayload } from '../serialization/encrypt.js';
import { CHUNK_LENGTH_1MB } from '../serialization/chunk.js';

async function serializeAndEncryptPayload(payload, payloadRootEncryptionKey) {
    const headers = SerializableTransportPayloadHeaders.FromEncryptedPayloadHeaders(payload.Headers).ToBuffer();
    return serialize(await encryptPayload(headers, payload.Content, payloadRootEncryptionKey, CHUNK_LENGTH_1MB));
}

export { serializeAndEncryptPayload };
