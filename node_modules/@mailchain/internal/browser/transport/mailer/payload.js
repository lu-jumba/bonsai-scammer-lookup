import { KindNaClSecretKey } from '@mailchain/crypto';
import { EncodingTypes } from '@mailchain/encoding';
import { createContentBuffer } from './content.js';

async function createMailerPayload(mailerMessagingKey, contentPayload) {
    const contentBuffer = Buffer.from(createContentBuffer(contentPayload));
    return {
        Headers: {
            Origin: mailerMessagingKey.publicKey,
            ContentSignature: await mailerMessagingKey.sign(contentBuffer),
            Created: new Date(),
            ContentLength: contentBuffer.length,
            ContentType: 'message/x.mailchain-mailer',
            ContentEncoding: EncodingTypes.Base64,
            ContentEncryption: KindNaClSecretKey,
        },
        Content: contentBuffer,
    };
}

export { createMailerPayload };
